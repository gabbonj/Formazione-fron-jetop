{"openapi":"3.0.3","info":{"title":"Progetto Recluta - Autenticazione","version":"1.0.0","description":"API di autenticazione con login in 2 fasi (OTP)"},"servers":[{"url":"http://localhost:4000"}],"tags":[{"name":"Authentication","description":"Flusso di autenticazione"},{"name":"OTP","description":"Gestione OTP"}],"paths":{"/api/auth/register":{"post":{"tags":["Authentication"],"summary":"Registra un nuovo utente","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterRequest"}}}},"responses":{"201":{"description":"Utente creato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterResponse"}}}},"400":{"description":"Dati invalidi o utente già esistente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"description":"Errore interno"}}}},"/api/auth/login":{"post":{"tags":["Authentication"],"summary":"Login (fase 1) con username e password","description":"Se l'utente ha OTP attivo, ritorna `requires_otp: true` e `temp_token` (valido 5 minuti).\nAltrimenti ritorna direttamente il JWT finale.\n","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}}},"responses":{"200":{"description":"Login effettuato o OTP richiesto","content":{"application/json":{"schema":{"oneOf":[{"$ref":"#/components/schemas/LoginSuccessResponse"},{"$ref":"#/components/schemas/LoginOtpRequiredResponse"}]}}}},"400":{"description":"Mancano username/password","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"401":{"description":"Credenziali non valide","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"description":"Errore interno"}}}},"/api/auth/verify-otp":{"post":{"tags":["Authentication"],"summary":"Verifica OTP (fase 2) e completa il login","description":"Richiede `temp_token` dal login fase 1 e `otp_token` (codice OTP 6 cifre).\nSe valido, ritorna il JWT finale.\n","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerifyOtpRequest"}}}},"responses":{"200":{"description":"OTP verificato, login completato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginSuccessResponse"}}}},"400":{"description":"Mancano temp_token o otp_token","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"401":{"description":"Temp token scaduto/non valido o OTP errato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"description":"Errore interno"}}}},"/api/auth/logout":{"post":{"tags":["Authentication"],"summary":"Esegui logout (invalida il token lato client)","security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Logout effettuato","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean","example":true},"message":{"type":"string","example":"Logout effettuato"}}}}}},"401":{"description":"Non autenticato"},"500":{"description":"Errore interno"}}}},"/api/auth/otp/setup":{"get":{"tags":["OTP"],"summary":"Ottieni/crea secret OTP e URL QR","security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Secret e otpauth_url per configurare OTP","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OtpSetupResponse"}}}},"401":{"description":"Non autenticato"},"500":{"description":"Errore interno"}}}},"/api/auth/otp/status":{"get":{"tags":["OTP"],"summary":"Stato OTP per l'utente corrente","security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Stato OTP","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OtpStatusResponse"}}}},"401":{"description":"Non autenticato"},"500":{"description":"Errore interno"}}}},"/api/auth/me":{"get":{"tags":["Authentication"],"summary":"Dati utente corrente","security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Dati utente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MeResponse"}}}},"401":{"description":"Non autenticato"},"500":{"description":"Errore interno"}}}}},"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}},"schemas":{"ErrorResponse":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"User":{"type":"object","properties":{"id":{"type":"integer","example":123},"username":{"type":"string","example":"mario.rossi"},"email":{"type":"string","format":"email","example":"mario.rossi@example.com"}}},"RegisterRequest":{"type":"object","properties":{"username":{"type":"string"},"email":{"type":"string","format":"email"},"password":{"type":"string"}},"required":["username","email","password"]},"RegisterResponse":{"type":"object","properties":{"user":{"$ref":"#/components/schemas/User"},"token":{"type":"string","description":"JWT (24h)"},"otp_secret":{"type":"string","description":"Secret OTP in base32"}},"required":["user","token","otp_secret"]},"LoginRequest":{"type":"object","properties":{"username":{"type":"string"},"password":{"type":"string"}},"required":["username","password"]},"LoginSuccessResponse":{"type":"object","properties":{"success":{"type":"boolean","example":true},"token":{"type":"string"},"user":{"$ref":"#/components/schemas/User"}},"required":["success","token","user"]},"LoginOtpRequiredResponse":{"type":"object","properties":{"success":{"type":"boolean","example":false},"requires_otp":{"type":"boolean","example":true},"temp_token":{"type":"string","description":"Token temporaneo valido 5 minuti"},"message":{"type":"string","example":"Inserisci il codice OTP per completare il login"}},"required":["success","requires_otp","temp_token"]},"VerifyOtpRequest":{"type":"object","properties":{"temp_token":{"type":"string","description":"Token temporaneo restituito dal login fase 1"},"otp_token":{"type":"string","description":"Codice OTP a 6 cifre"}},"required":["temp_token","otp_token"]},"OtpSetupResponse":{"type":"object","properties":{"secret":{"type":"string","description":"Secret OTP in base32"},"otpauth_url":{"type":"string","description":"URL per generare il QR code"}},"required":["secret","otpauth_url"]},"OtpStatusResponse":{"type":"object","properties":{"has_otp":{"type":"boolean"},"message":{"type":"string"}},"required":["has_otp"]},"MeResponse":{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"integer"},"username":{"type":"string"},"email":{"type":"string","format":"email"},"has_otp":{"type":"boolean"},"bio":{"type":"string","nullable":true}},"required":["id","username","email","has_otp"]}},"required":["user"]}}}}
{"openapi":"3.0.3","info":{"title":"Users API","version":"1.0.0","description":"Endpoints per la gestione degli utenti (tabella `users` su Supabase).\nImplementazione basata su Express Router.\n"},"servers":[{"url":"http://localhost:4000/api","description":"Dev server"}],"tags":[{"name":"Users","description":"Operazioni CRUD sugli utenti"}],"paths":{"/users":{"get":{"tags":["Users"],"summary":"Lista utenti con paginazione e ricerca","description":"Restituisce la lista degli utenti ordinati per `created_at` DESC.\nSupporta paginazione (`limit`, `offset`) e filtro testo (`q`) su username/email.\n","parameters":[{"$ref":"#/components/parameters/Limit"},{"$ref":"#/components/parameters/Offset"},{"$ref":"#/components/parameters/Q"}],"responses":{"200":{"description":"Lista utenti","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UsersListResponse"},"examples":{"ok":{"value":{"items":[{"id":"1a2b3c","username":"francesco","email":"francesco@example.com","bio":"Ciao!","password_hash":"$2b$10$***********************","created_at":"2025-11-05T09:00:00Z"},{"id":"9f8e7d","username":"simona","email":"simona@example.com","bio":null,"password_hash":"$2b$10$***********************","created_at":"2025-11-04T17:31:22Z"}],"count":2,"limit":20,"offset":0}}}}}},"400":{"description":"Parametri non validi","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"post":{"tags":["Users"],"summary":"Crea un nuovo utente","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"},"examples":{"create":{"value":{"username":"nuovo_user","email":"user@example.com","password_hash":"$2b$10$***********************","bio":"Bio opzionale"}}}}}},"responses":{"201":{"description":"Utente creato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"400":{"description":"Campi mancanti o non validi","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/users/{id}":{"get":{"tags":["Users"],"summary":"Recupera un utente per ID","parameters":[{"$ref":"#/components/parameters/UserId"}],"responses":{"200":{"description":"Utente trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"404":{"description":"Utente non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"patch":{"tags":["Users"],"summary":"Aggiorna parzialmente un utente","parameters":[{"$ref":"#/components/parameters/UserId"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdate"},"examples":{"update":{"value":{"bio":"Nuova bio","email":"nuova.email@example.com"}}}}}},"responses":{"200":{"description":"Utente aggiornato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"400":{"description":"Nessun campo da aggiornare o payload non valido","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"404":{"description":"Utente non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"delete":{"tags":["Users"],"summary":"Elimina un utente","parameters":[{"$ref":"#/components/parameters/UserId"}],"responses":{"204":{"description":"Eliminato con successo (nessun contenuto)"},"404":{"description":"Utente non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}}},"components":{"parameters":{"Limit":{"name":"limit","in":"query","description":"Numero massimo di record (max 100; default 20)","required":false,"schema":{"type":"integer","minimum":1,"maximum":100,"default":20}},"Offset":{"name":"offset","in":"query","description":"Indice di partenza (default 0)","required":false,"schema":{"type":"integer","minimum":0,"default":0}},"Q":{"name":"q","in":"query","description":"Testo per filtrare per username/email (case-insensitive)","required":false,"schema":{"type":"string","minLength":1}},"UserId":{"name":"id","in":"path","required":true,"description":"Identificativo utente (string o UUID a seconda del DB)","schema":{"type":"string","example":"1a2b3c"}}},"schemas":{"User":{"type":"object","required":["id","username","email","password_hash","created_at"],"properties":{"id":{"type":"string","description":"Identificativo dell'utente (string/UUID)","example":"1a2b3c"},"username":{"type":"string","example":"francesco"},"email":{"type":"string","format":"email","example":"francesco@example.com"},"bio":{"type":"string","nullable":true,"example":"Ciao!"},"password_hash":{"type":"string","description":"Hash della password (es. bcrypt)","example":"$2b$10$***********************"},"created_at":{"type":"string","format":"date-time","example":"2025-11-05T09:00:00Z"}}},"UserCreate":{"type":"object","required":["username","email","password_hash"],"properties":{"username":{"type":"string","example":"nuovo_user"},"email":{"type":"string","format":"email","example":"user@example.com"},"password_hash":{"type":"string","description":"Hash della password (es. bcrypt)","example":"$2b$10$***********************"},"bio":{"type":"string","nullable":true,"example":"Bio opzionale"}}},"UserUpdate":{"type":"object","description":"Campi aggiornabili (PATCH)","properties":{"username":{"type":"string","example":"francesco_updated"},"email":{"type":"string","format":"email","example":"nuova.email@example.com"},"password_hash":{"type":"string","description":"Nuovo hash password","example":"$2b$10$***********************"},"bio":{"type":"string","nullable":true,"example":"Nuova bio"}},"additionalProperties":false},"UsersListResponse":{"type":"object","properties":{"items":{"type":"array","items":{"$ref":"#/components/schemas/User"}},"count":{"type":"integer","description":"Numero totale di record che matchano il filtro","example":42},"limit":{"type":"integer","example":20},"offset":{"type":"integer","example":0}}},"Error":{"type":"object","properties":{"error":{"type":"string","example":"Not found"}}}}}}
{"openapi":"3.0.3","info":{"title":"Posts API","version":"1.0.0","description":"CRUD dei post con integrazione Supabase.\nLe operazioni di creazione/modifica/cancellazione richiedono JWT.\n"},"servers":[{"url":"http://localhost:4000/api","description":"Dev server"}],"tags":[{"name":"Posts","description":"Operazioni sui post"}],"paths":{"/posts":{"get":{"tags":["Posts"],"summary":"Lista post (paginata, opz. filtrata per utente)","parameters":[{"$ref":"#/components/parameters/Limit"},{"$ref":"#/components/parameters/Offset"},{"$ref":"#/components/parameters/UserIdQuery"}],"responses":{"200":{"description":"Lista post","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostsListResponse"},"examples":{"ok":{"value":{"items":[{"id":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a","user_id":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f","content":"Hello world!","created_at":"2025-11-05T10:20:30Z","user":{"id":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f","username":"francesco"}}],"count":1,"limit":20,"offset":0}}}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"post":{"tags":["Posts"],"summary":"Crea un nuovo post (autenticato)","security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostCreate"},"examples":{"create":{"value":{"content":"Questo è il mio primo post!"}}}}}},"responses":{"201":{"description":"Post creato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Post"}}}},"400":{"description":"Campi mancanti o non validi","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"401":{"description":"Non autenticato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/posts/{id}":{"get":{"tags":["Posts"],"summary":"Dettaglio post per ID","parameters":[{"$ref":"#/components/parameters/PostId"}],"responses":{"200":{"description":"Post trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Post"}}}},"404":{"description":"Non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"patch":{"tags":["Posts"],"summary":"Aggiorna contenuto post (owner-only)","security":[{"bearerAuth":[]}],"parameters":[{"$ref":"#/components/parameters/PostId"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostUpdate"},"examples":{"update":{"value":{"content":"Contenuto aggiornato"}}}}}},"responses":{"200":{"description":"Post aggiornato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Post"}}}},"400":{"description":"Nessun campo da aggiornare / payload non valido","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"401":{"description":"Non autenticato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"403":{"description":"Proibito (non sei il proprietario)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"404":{"description":"Non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"delete":{"tags":["Posts"],"summary":"Elimina post (owner-only)","security":[{"bearerAuth":[]}],"parameters":[{"$ref":"#/components/parameters/PostId"}],"responses":{"204":{"description":"Eliminato (nessun contenuto)"},"401":{"description":"Non autenticato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"403":{"description":"Proibito (non sei il proprietario)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"404":{"description":"Non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}}},"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}},"parameters":{"Limit":{"name":"limit","in":"query","description":"Numero massimo di record (max 100; default 20)","required":false,"schema":{"type":"integer","minimum":1,"maximum":100,"default":20}},"Offset":{"name":"offset","in":"query","description":"Indice di partenza (default 0)","required":false,"schema":{"type":"integer","minimum":0,"default":0}},"UserIdQuery":{"name":"user_id","in":"query","description":"Filtra per ID utente proprietario del post","required":false,"schema":{"type":"string","description":"UUID o string ID","example":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f"}},"PostId":{"name":"id","in":"path","required":true,"description":"Identificativo del post","schema":{"type":"string","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"}}},"schemas":{"Post":{"type":"object","required":["id","user_id","content","created_at"],"properties":{"id":{"type":"string","description":"ID del post","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"},"user_id":{"type":"string","description":"ID dell'utente autore","example":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f"},"content":{"type":"string","example":"Hello world!"},"created_at":{"type":"string","format":"date-time","example":"2025-11-05T10:20:30Z"},"user":{"type":"object","nullable":true,"description":"Join (parziale) con tabella users (id, username)","properties":{"id":{"type":"string","example":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f"},"username":{"type":"string","example":"francesco"}}}}},"PostCreate":{"type":"object","required":["content"],"properties":{"content":{"type":"string","minLength":1,"example":"Questo è il mio primo post!"}}},"PostUpdate":{"type":"object","description":"Campi aggiornabili (solo contenuto)","properties":{"content":{"type":"string","minLength":1,"example":"Contenuto aggiornato"}},"additionalProperties":false},"PostsListResponse":{"type":"object","properties":{"items":{"type":"array","items":{"$ref":"#/components/schemas/Post"}},"count":{"type":"integer","description":"Numero totale di record che matchano il filtro","example":42},"limit":{"type":"integer","example":20},"offset":{"type":"integer","example":0}}},"Error":{"type":"object","properties":{"error":{"type":"string","example":"Not found"}}}}}}
{"openapi":"3.0.3","info":{"title":"Likes API","version":"1.0.0","description":"Gestione dei like ai post. Creazione e rimozione richiedono JWT.\n"},"servers":[{"url":"http://localhost:4000/api","description":"Dev server"}],"tags":[{"name":"Likes","description":"Operazioni sui like"}],"paths":{"/likes":{"get":{"tags":["Likes"],"summary":"Lista o conteggio dei like","description":"Restituisce l'elenco dei like filtrabile per `post_id` e/o `user_id`.\nSe `count=true`, ritorna solo il conteggio.\n","parameters":[{"$ref":"#/components/parameters/PostIdQuery"},{"$ref":"#/components/parameters/UserIdQuery"},{"$ref":"#/components/parameters/CountFlag"}],"responses":{"200":{"description":"Lista like o solo conteggio","content":{"application/json":{"examples":{"list":{"value":{"items":[{"id":"a1b2c3","post_id":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a","user_id":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f","created_at":"2025-11-05T12:10:00Z"}],"count":1}},"countOnly":{"value":{"count":42}}}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"post":{"tags":["Likes"],"summary":"Metti like a un post (idempotente)","description":"Aggiunge un like dell'utente autenticato a `post_id`.\nSe il like esiste già, risponde 200 con `{ ok: true }`.\n","security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LikeCreate"},"examples":{"create":{"value":{"post_id":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"}}}}}},"responses":{"200":{"description":"Like già presente (operazione idempotente)","content":{"application/json":{"schema":{"type":"object","properties":{"ok":{"type":"boolean","example":true}}}}}},"201":{"description":"Like creato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Like"}}}},"400":{"description":"Campo mancante/non valido (es. `post_id`)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"401":{"description":"Non autenticato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"delete":{"tags":["Likes"],"summary":"Rimuovi like da un post (owner-only)","description":"Rimuove il like dell'utente autenticato per `post_id`.\n**Nota:** questo endpoint usa un body nella DELETE.\n","security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["post_id"],"properties":{"post_id":{"type":"string","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"}}}}}},"responses":{"204":{"description":"Eliminato (nessun contenuto)"},"400":{"description":"Campo mancante/non valido (es. `post_id`)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"401":{"description":"Non autenticato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}}},"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}},"parameters":{"PostIdQuery":{"name":"post_id","in":"query","required":false,"description":"Filtra per ID del post","schema":{"type":"string","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"}},"UserIdQuery":{"name":"user_id","in":"query","required":false,"description":"Filtra per ID dell'utente che ha messo like","schema":{"type":"string","example":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f"}},"CountFlag":{"name":"count","in":"query","required":false,"description":"Se `true`, ritorna solo il conteggio dei like che matchano i filtri","schema":{"type":"string","enum":["true","false"],"default":"false"}}},"schemas":{"Like":{"type":"object","required":["id","post_id","user_id","created_at"],"properties":{"id":{"type":"string","description":"ID del like","example":"a1b2c3"},"post_id":{"type":"string","description":"ID del post","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"},"user_id":{"type":"string","description":"ID dell'utente che ha messo like","example":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f"},"created_at":{"type":"string","format":"date-time","example":"2025-11-05T12:10:00Z"}}},"LikeCreate":{"type":"object","required":["post_id"],"properties":{"post_id":{"type":"string","description":"ID del post a cui mettere like","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"}}},"LikesListResponse":{"type":"object","properties":{"items":{"type":"array","items":{"$ref":"#/components/schemas/Like"}},"count":{"type":"integer","example":1}}},"CountResponse":{"type":"object","properties":{"count":{"type":"integer","example":42}}},"Error":{"type":"object","properties":{"error":{"type":"string","example":"Not found"}}}}}}
{"openapi":"3.0.3","info":{"title":"Comments API","version":"1.0.0","description":"CRUD dei commenti con Supabase.\nLe operazioni di creazione/modifica/cancellazione richiedono JWT.\n"},"servers":[{"url":"http://localhost:4000/api","description":"Dev server"}],"tags":[{"name":"Comments","description":"Operazioni sui commenti"}],"paths":{"/comments":{"get":{"tags":["Comments"],"summary":"Lista commenti (paginata; filtro per post)","parameters":[{"$ref":"#/components/parameters/Limit"},{"$ref":"#/components/parameters/Offset"},{"$ref":"#/components/parameters/PostIdQuery"}],"responses":{"200":{"description":"Lista commenti","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommentsListResponse"},"examples":{"ok":{"value":{"items":[{"id":"c7a8c2a4-8b0d-4c1e-9f44-9fb8c7b5d9a2","post_id":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a","user_id":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f","content":"Bel post!","created_at":"2025-11-05T11:15:00Z","user":{"id":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f","username":"francesco"}}],"count":1,"limit":20,"offset":0}}}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"post":{"tags":["Comments"],"summary":"Crea un nuovo commento (autenticato)","security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommentCreate"},"examples":{"create":{"value":{"post_id":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a","content":"Ottimo!"}}}}}},"responses":{"201":{"description":"Commento creato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Comment"}}}},"400":{"description":"Campi mancanti o non validi","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"401":{"description":"Non autenticato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/comments/{id}":{"get":{"tags":["Comments"],"summary":"Dettaglio commento per ID","parameters":[{"$ref":"#/components/parameters/CommentId"}],"responses":{"200":{"description":"Commento trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommentWithPost"}}}},"404":{"description":"Non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"patch":{"tags":["Comments"],"summary":"Aggiorna contenuto commento (owner-only)","security":[{"bearerAuth":[]}],"parameters":[{"$ref":"#/components/parameters/CommentId"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommentUpdate"},"examples":{"update":{"value":{"content":"Testo aggiornato"}}}}}},"responses":{"200":{"description":"Commento aggiornato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Comment"}}}},"400":{"description":"Nessun campo da aggiornare / payload non valido","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"401":{"description":"Non autenticato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"403":{"description":"Proibito (non sei il proprietario)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"404":{"description":"Non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"delete":{"tags":["Comments"],"summary":"Elimina commento (owner-only)","security":[{"bearerAuth":[]}],"parameters":[{"$ref":"#/components/parameters/CommentId"}],"responses":{"204":{"description":"Eliminato (nessun contenuto)"},"401":{"description":"Non autenticato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"403":{"description":"Proibito (non sei il proprietario)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"404":{"description":"Non trovato","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Errore interno","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}}},"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}},"parameters":{"Limit":{"name":"limit","in":"query","description":"Numero massimo di record (max 100; default 20)","required":false,"schema":{"type":"integer","minimum":1,"maximum":100,"default":20}},"Offset":{"name":"offset","in":"query","description":"Indice di partenza (default 0)","required":false,"schema":{"type":"integer","minimum":0,"default":0}},"PostIdQuery":{"name":"post_id","in":"query","description":"Filtra i commenti per ID del post","required":false,"schema":{"type":"string","description":"UUID o string ID del post","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"}},"CommentId":{"name":"id","in":"path","required":true,"description":"Identificativo del commento","schema":{"type":"string","example":"c7a8c2a4-8b0d-4c1e-9f44-9fb8c7b5d9a2"}}},"schemas":{"Comment":{"type":"object","required":["id","post_id","user_id","content","created_at"],"properties":{"id":{"type":"string","description":"ID del commento","example":"c7a8c2a4-8b0d-4c1e-9f44-9fb8c7b5d9a2"},"post_id":{"type":"string","description":"ID del post a cui appartiene","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"},"user_id":{"type":"string","description":"ID dell'utente autore","example":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f"},"content":{"type":"string","example":"Bel post!"},"created_at":{"type":"string","format":"date-time","example":"2025-11-05T11:15:00Z"},"user":{"type":"object","nullable":true,"description":"Join (parziale) con tabella users (id, username)","properties":{"id":{"type":"string","example":"7f6b3f3e-9d1b-4c5e-9e7f-1a2b3c4d5e6f"},"username":{"type":"string","example":"francesco"}}}}},"CommentWithPost":{"allOf":[{"$ref":"#/components/schemas/Comment"},{"type":"object","properties":{"post":{"type":"object","nullable":true,"description":"Join (parziale) con tabella posts (solo id)","properties":{"id":{"type":"string","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"}}}}}]},"CommentCreate":{"type":"object","required":["post_id","content"],"properties":{"post_id":{"type":"string","description":"ID del post","example":"51c744b4-1a3f-4f1f-8f3e-9d547e7d1b9a"},"content":{"type":"string","minLength":1,"example":"Ottimo!"}}},"CommentUpdate":{"type":"object","description":"Campi aggiornabili (solo `content`)","properties":{"content":{"type":"string","minLength":1,"example":"Testo aggiornato"}},"additionalProperties":false},"CommentsListResponse":{"type":"object","properties":{"items":{"type":"array","items":{"$ref":"#/components/schemas/Comment"}},"count":{"type":"integer","description":"Numero totale di record che matchano il filtro","example":42},"limit":{"type":"integer","example":20},"offset":{"type":"integer","example":0}}},"Error":{"type":"object","properties":{"error":{"type":"string","example":"Not found"}}}}}}